
# services:
#   frontend:
#     build:
#       context: .
#       dockerfile: Dockerfile
#     ports:
#       - "3001:3000"
#     environment:
#       - NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=${NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}
#       - CLERK_SECRET_KEY=${CLERK_SECRET_KEY}
#       - CLERK_WEBHOOK_SECRET=${CLERK_WEBHOOK_SECRET}
#       - NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
#       - NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
#       - NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/
#       - NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/
#       - ARCJET_KEY=${ARCJET_KEY}
#       - NEXT_PUBLIC_FLUTTERWAVE_PUBLIC_KEY=${NEXT_PUBLIC_FLUTTERWAVE_PUBLIC_KEY}
#       - FLUTTERWAVE_SECRET_KEY=${FLUTTERWAVE_SECRET_KEY}
#       - FLUTTERWAVE_WEBHOOK_SECRET=${FLUTTERWAVE_WEBHOOK_SECRET}
#       - NEXT_PUBLIC_SERVER_URL=http://localhost:3000
#       - DATABASE_URL=${DATABASE_URL}
#     volumes:
#       - .:/app
#       - /app/node_modules
#     command: sh -c "sleep 5 && npm run db:migrate && npm run dev"

version: '3.8'

services:
  dashboard:
    build: .
    container_name: dashboard_app
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
      - NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=${NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}
      - CLERK_SECRET_KEY=${CLERK_SECRET_KEY}
      - CLERK_WEBHOOK_SECRET=${CLERK_WEBHOOK_SECRET}
      - NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
      - NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
      - NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/
      - NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/
      - ARCJET_KEY=${ARCJET_KEY}
      - NEXT_PUBLIC_FLUTTERWAVE_PUBLIC_KEY=${NEXT_PUBLIC_FLUTTERWAVE_PUBLIC_KEY}
      - FLUTTERWAVE_SECRET_KEY=${FLUTTERWAVE_SECRET_KEY}
      - FLUTTERWAVE_WEBHOOK_SECRET=${FLUTTERWAVE_WEBHOOK_SECRET}
      # Remove NEXT_PUBLIC_SERVER_URL or set dynamically
      - R2_ACCOUNT_ID=${R2_ACCOUNT_ID}
      - R2_ACCESS_KEY_ID=${R2_ACCESS_KEY_ID}
      - R2_SECRET_ACCESS_KEY=${R2_SECRET_ACCESS_KEY}
      - R2_BUCKET_NAME=${R2_BUCKET_NAME}
      - R2_PUBLIC_URL=${R2_PUBLIC_URL}
    networks:
      - app-network

networks:
  app-network:
    driver: bridge